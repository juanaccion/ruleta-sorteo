<div class="app-container">
      
      <!-- Header -->
      <header class="app-header">
        <div class="flex items-center gap-2">
          <!-- Icon Gift -->
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="header-icon"><rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13"/><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/><path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"/></svg>
          <h1 class="header-title">PromoGana</h1>
        </div>
        <button 
          (click)="setView('admin')"
          class="admin-button"
        >
          Admin
        </button>
      </header>

      <main class="main-content">
        
        <!-- LOADING STATE -->
        <div *ngIf="loading()" class="flex items-center justify-center">
           <svg class="loading-spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
             <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
             <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
           </svg>
        </div>

        <!-- VIEW: REGISTER -->
        <div *ngIf="!loading() && view() === 'register'" class="register-card animate-fade-in">
            <div class="text-center mb-8">
              <!-- Icon Trophy -->
              <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="card-icon"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
              
              <h2 class="card-title">¡Participa y Gana!</h2>
              <p class="text-indigo-200">Ingresa tus datos para girar la ruleta.</p>
            </div>
            
            <form (submit)="handleRegister($event)" class="space-y-4">
              <div class="form-group">
                <label class="form-label">Tu Nombre</label>
                <input 
                  type="text" 
                  [(ngModel)]="name" 
                  name="name"
                  class="form-input"
                  placeholder="Ej. Juan Pérez"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label">Usuario Instagram/TikTok</label>
                <div class="form-input-wrapper">
                    <!-- CORRECCIÓN AQUÍ: Usamos &#64; en lugar de @ -->
                    <span class="form-input-prefix">&#64;</span>
                    <input 
                      type="text" 
                      [(ngModel)]="handle"
                      name="handle"
                      class="form-input handle-input"
                      placeholder="usuario"
                      required
                    />
                </div>
              </div>
              <button 
                type="submit"
                class="submit-button"
              >
                Comenzar Juego
              </button>
            </form>
        </div>

        <!-- VIEW: GAME (Roulette) -->
        <div *ngIf="!loading() && view() === 'game'" class="game-view animate-fade-in">
            <h2 class="text-2xl font-bold mb-8 text-center">¡Mucha suerte, {{ firstName() }}!</h2>
            
            <div class="wheel-wrapper">
               <!-- Pointer -->
               <div class="wheel-pointer"></div>

               <!-- Wheel -->
               <div 
                   #wheelRef
                   class="wheel"
                 [style.transform]="'rotate(' + rotation() + 'deg)'"
                 [style.background]="conicGradient"
                 [style.--label-translate]="labelTranslatePx() + 'px'"
                 [style.--label-width]="labelWidthPercent() + '%'"
                 [style.transition]="'transform ' + transitionDurationMs() + 'ms cubic-bezier(0.3, 0.7, 0.4, 1)'"
               >
                  <!-- Labels -->
                     <div 
                       *ngFor="let prize of prizes; let i = index"
                       class="prize-label"
                         [style.transform]="'translateY(-50%) rotate(' + (i * segmentAngle) + 'deg) translateX(' + labelTranslatePx() + 'px)'"
                     >
                      <span>{{ prize.label }}</span>
                    </div>
                  
                  <!-- Center knob (moved inside wheel for precise centering) -->
                    <div #centerRef class="wheel-center">
                      <span>GO</span>
                    </div>

                  
               </div>
               
            </div>

             <!-- Controls para ajustar etiquetas en vivo -->
            <button 
              (click)="spinWheel()"
              [disabled]="isSpinning()"
              class="spin-button"
            >
              {{ isSpinning() ? 'Girando...' : 'GIRAR' }}
            </button>
        </div>

        <!-- VIEW: RESULT -->
        <div *ngIf="!loading() && view() === 'result'" class="result-card">
            <!-- Icon Party -->
            <svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-party"><path d="M5.8 11.3 2 22l10.7-3.79"/><path d="M4 3h.01"/><path d="M22 8h.01"/><path d="M15 2h.01"/><path d="M22 20h.01"/><path d="m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12v0c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10"/><path d="m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11v0c-.11.7-.72 1.22-1.43 1.22H17"/><path d="m11 2 .33.82c.34.86-.2 1.82-1.11 1.98v0C9.52 4.9 9 5.52 9 6.23V7"/><path d="M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z"/></svg>
            
            
            <h2 class="result-title">¡Felicidades!</h2>
            <p class="text-indigo-200 mb-6 text-lg">Has ganado:</p>
            <div class="prize-box">
              {{ wonPrize() }}
            </div>
            <p class="text-sm text-indigo-300 mb-8">
              <!-- CORRECCIÓN AQUÍ: Usamos &#64; en lugar de @ -->
              Hemos registrado tu participación con el usuario <span class="font-bold text-white">&#64;{{ handle() }}</span>.
              Te contactaremos si eres el ganador final.
            </p>
            <button 
              (click)="reset()"
              class="reset-link"
            >
              Volver al inicio
            </button>
        </div>

        <!-- VIEW: ADMIN -->
        <div *ngIf="!loading() && view() === 'admin'" class="admin-panel animate-fade-in">
            <div class="panel-header">
              <h2 class="panel-title">
                <!-- Icon Lock -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lock-icon"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                Panel de Control
              </h2>
              <button (click)="setView('register')" class="close-button">Cerrar</button>
            </div>

            <div class="panel-body">
              <!-- List -->
              <div class="leads-list">
                <h3 class="list-header">
                  <!-- Icon Users -->
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                  Participantes ({{ leads().length }})
                </h3>
                <div class="space-y-2">
                  <div *ngFor="let lead of leads()" class="lead-item">
                      <div>
                        <p class="lead-name">{{ lead.name }}</p>
                        <!-- CORRECCIÓN AQUÍ: Usamos &#64; en lugar de @ -->
                        <p class="lead-handle">&#64;{{ lead.handle }}</p>
                      </div>
                      <div class="text-right">
                        <span class="lead-prize">
                          {{ lead.prizeWon }}
                        </span>
                      </div>
                  </div>
                  <p *ngIf="leads().length === 0" class="no-leads">No hay participantes aún.</p>
                </div>
              </div>

              <!-- Actions -->
              <div class="admin-actions">
                <!-- Icon Crown -->
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="crown-icon"><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></svg>
                
                <h3 class="action-title">Sorteo Final</h3>
                <p class="action-description">Elige un ganador al azar entre todos los participantes registrados.</p>
                
                <button 
                  (click)="pickRandomWinner()"
                  [disabled]="leads().length === 0"
                  class="winner-button"
                >
                  ¡Elegir Ganador!
                </button>

                <div *ngIf="selectedWinner()" class="winner-box">
                    <p class="winner-label">Ganador Seleccionado</p>
                    <p class="winner-name">{{ selectedWinner()!.name }}</p>
                    <!-- CORRECCIÓN AQUÍ: Usamos &#64; en lugar de @ -->
                    <p class="winner-handle">&#64;{{ selectedWinner()!.handle }}</p>
                    <div class="winner-prize">Premio obtenido: {{ selectedWinner()!.prizeWon }}</div>
                </div>
              </div>
            </div>
        </div>

      </main>
    </div>